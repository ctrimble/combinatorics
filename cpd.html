<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Mar 21, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130321" />
    <meta http-equiv="Content-Language" content="en" />
    <title>CPD Results</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarEnabled">
          
    
    
            
    
        
    <a href="http://github.com/ctrimble/combinatorics">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                                                                <a class="brand" href="index.html"  title="Java Combinatorics">

                                
                                                                                                                    <img src="images/topbar-logo.png" alt="Java Combinatorics" />
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Combinatorics <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Introduction">Introduction</a>
</li>
                  
                      <li>      <a href="apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="project-info.html"  title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="integration.html"  title="Continuous Integration">Continuous Integration</a>
</li>
                                  <li>      <a href="project-summary.html"  title="Project Summary">Project Summary</a>
</li>
                                  <li>      <a href="mail-lists.html"  title="Mailing Lists">Mailing Lists</a>
</li>
                                  <li>      <a href="issue-tracking.html"  title="Issue Tracking">Issue Tracking</a>
</li>
                                  <li>      <a href="plugins.html"  title="Project Plugins">Project Plugins</a>
</li>
                                  <li>      <a href="dependency-management.html"  title="Dependency Management">Dependency Management</a>
</li>
                                  <li>      <a href="license.html"  title="Project License">Project License</a>
</li>
                                  <li>      <a href="distribution-management.html"  title="Distribution Management">Distribution Management</a>
</li>
                                  <li>      <a href="source-repository.html"  title="Source Repository">Source Repository</a>
</li>
                                  <li>      <a href="team-list.html"  title="Project Team">Project Team</a>
</li>
                                  <li>      <a href="plugin-management.html"  title="Plugin Management">Plugin Management</a>
</li>
                                  <li>      <a href="index.html"  title="About">About</a>
</li>
                                  <li>      <a href="dependencies.html"  title="Dependencies">Dependencies</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="project-reports.html"  title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="testapidocs/index.html"  title="Test JavaDocs">Test JavaDocs</a>
</li>
                                  <li>      <a href="xref/index.html"  title="Source Xref">Source Xref</a>
</li>
                                  <li>      <a href="xref-test/index.html"  title="Test Source Xref">Test Source Xref</a>
</li>
                                  <li>      <a href="pmd.html"  title="PMD Report">PMD Report</a>
</li>
                                  <li>      <a href="cpd.html"  title="CPD Report">CPD Report</a>
</li>
                                  <li>      <a href="surefire-report.html"  title="Surefire Report">Surefire Report</a>
</li>
                                  <li>      <a href="failsafe-report.html"  title="Surefire Report">Surefire Report</a>
</li>
                                  <li>      <a href="dependency-analysis.html"  title="Dependency Analysis">Dependency Analysis</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Java Combinatorics Library</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2013-03-21</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 0.3.0-SNAPSHOT</li>
                      
                
            
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                <ul class="nav nav-list">
                    <li class="nav-header">Combinatorics</li>
                                
      <li>
    
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="apidocs/index.html" title="JavaDocs">
          <i class="none"></i>
        JavaDocs</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                          
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                              
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-down"></i>
        Project Reports</a>
                    <ul class="nav nav-list">
                      
      <li>
    
                          <a href="apidocs/index.html" title="JavaDocs">
          <i class="none"></i>
        JavaDocs</a>
            </li>
                      
      <li>
    
                          <a href="testapidocs/index.html" title="Test JavaDocs">
          <i class="none"></i>
        Test JavaDocs</a>
            </li>
                      
      <li>
    
                          <a href="xref/index.html" title="Source Xref">
          <i class="none"></i>
        Source Xref</a>
            </li>
                      
      <li>
    
                          <a href="xref-test/index.html" title="Test Source Xref">
          <i class="none"></i>
        Test Source Xref</a>
            </li>
                      
      <li>
    
                          <a href="pmd.html" title="PMD Report">
          <i class="none"></i>
        PMD Report</a>
            </li>
                      
      <li class="active">
    
            <a href="#"><i class="none"></i>CPD Report</a>
          </li>
                      
      <li>
    
                          <a href="surefire-report.html" title="Surefire Report">
          <i class="none"></i>
        Surefire Report</a>
            </li>
                      
      <li>
    
                          <a href="failsafe-report.html" title="Surefire Report">
          <i class="none"></i>
        Surefire Report</a>
            </li>
                      
      <li>
    
                          <a href="dependency-analysis.html" title="Dependency Analysis">
          <i class="none"></i>
        Dependency Analysis</a>
            </li>
              </ul>
        </li>
            </ul>
                
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
               
        
        
        <div id="twitter">
    
    <a href="https://twitter.com/xiantrimble" class="twitter-follow-button" data-show-count="true" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow xiantrimble</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        </div>
                   <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <div class="section"><h2>CPD Results<a name="CPD_Results"></a></h2><p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 4.2.5.</p></div><div class="section"><h2>Duplications<a name="Duplications"></a></h2><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/xiantrimble/combinatorics/Permutations.java</td><td><a href="./xref/com/xiantrimble/combinatorics/Permutations.html#124">124</a></td></tr><tr class="a"><td>com/xiantrimble/combinatorics/PermutationsEngine.java</td><td><a href="./xref/com/xiantrimble/combinatorics/PermutationsEngine.html#77">77</a></td></tr><tr class="b"><td colspan='2'><div><pre>        int windowEnd = last.length;
        int swapSource = 0;
        int swapTarget = 0;
        TYPE : for (int i = 0; i &lt; state.length; i++) {
          switch (state[i].direction) {
            case DOWN :
              // scan the entries from back to front, looking for the first item
              // to move.
              ENTRY : for (int j = state[i].count - 1; j &gt;= 0; j--) {
                switch (state[i].entryState[j].direction) {
                  case DOWN :
                    if (state[i].entryState[j].index &lt; (windowEnd - windowStart - 1) - ((state[i].count - 1) - j)) {
                      // track the source index for the swap.
                      swapSource = windowStart + state[i].entryState[j].index;

                      // increment the index and deal with moving over like
                      // elements
                      state[i].entryState[j].index++;
                      for (; j &lt; state[i].count - 1 &amp;&amp; state[i].entryState[j].index == state[i].entryState[j + 1].index; j++) {
                        state[i].entryState[j + 1].index++;
                        state[i].entryState[j + 1].direction = Direction.DOWN;
                      }

                      // track the target index for the swap.
                      swapTarget = windowStart + state[i].entryState[j].index;
                      break TYPE;
                    }
                    state[i].entryState[j].direction = Direction.UP;
                    break;
                  case UP :
                    int startIndex = j;
                    for (; state[i].entryState[j].index == state[i].entryState[j - 1].index + 1; j--) {
                      // if this entry is moving down, then switch case
                      // statements.
                      if (state[i].entryState[j - 1].direction == Direction.DOWN) {
                        continue ENTRY;
                      }
                    }
                    swapSource = windowStart + state[i].entryState[startIndex].index;
                    state[i].entryState[j].direction = Direction.UP;
                    state[i].entryState[j].index--;
                    swapTarget = windowStart + state[i].entryState[j].index;
                    for (j++; j &lt;= startIndex; j++) {
                      state[i].entryState[j].direction = Direction.DOWN;
                      state[i].entryState[j].index--;
                    }
                    break TYPE;
                }
              }
              // none of the entries can move down, switch directions.
              state[i].direction = Direction.UP;
              windowEnd -= state[i].count;
              if (i &lt; state.length - 1)
                continue TYPE;
              break;
            case UP :
              // scan the entries from front to back, looking for the first item
              // to move.
              ENTRY : for (int j = 0; j &lt; state[i].count; j++) {
                switch (state[i].entryState[j].direction) {
                  case UP :
                    if (state[i].entryState[j].index &gt; j) {
                      // track the source index of the swap.
                      swapSource = state[i].entryState[j].index + windowStart;

                      // decrement the index and deal with moving over like
                      // elements.
                      state[i].entryState[j].index--;
                      for (; j &gt; 0 &amp;&amp; state[i].entryState[j].index == state[i].entryState[j - 1].index; j--) {
                        state[i].entryState[j - 1].index--;
                        state[i].entryState[j - 1].direction = Direction.UP;
                      }

                      // track the target index for the swap.
                      swapTarget = state[i].entryState[j].index + windowStart;
                      break TYPE;
                    }
                    state[i].entryState[j].direction = Direction.DOWN;
                    break;
                  case DOWN :
                    int startIndex = j;
                    for (; state[i].entryState[j].index == state[i].entryState[j + 1].index - 1; j++) {
                      // if this entry is moving down, then switch case
                      // statements.
                      if (state[i].entryState[j + 1].direction == Direction.UP) {
                        continue ENTRY;
                      }
                    }
                    swapSource = windowStart + state[i].entryState[startIndex].index;
                    state[i].entryState[j].direction = Direction.DOWN;
                    state[i].entryState[j].index++;
                    swapTarget = windowStart + state[i].entryState[j].index;
                    for (j--; j &gt;= startIndex; j--) {
                      state[i].entryState[j].direction = Direction.UP;
                      state[i].entryState[j].index++;
                    }
                    break TYPE;
                }
              }
              state[i].direction = Direction.DOWN;
              windowStart += state[i].count;
              if (i &lt; state.length - 1)
                continue TYPE;
              break;
          }

          // end of permutations for this combination reached. Advance to the
          // next
          // combination.
          int cur = state.length - 1;
          int remaining = 0;

          // move cur backwards to find the next item to update.
          for (; cur &gt; 0 &amp;&amp; (state[cur].count == 0 || state[cur].toRight &lt; remaining + 1); remaining += state[cur--].count);

          // decrement the items at cur.
          state[cur].count--;
          remaining++;

          // move forward and update all of the counts.
          for (cur++; cur &lt; state.length; cur++) {
            state[cur].count = Math.min(remaining, domainRanks[cur]);</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/xiantrimble/combinatorics/IndexBasedPermutations.java</td><td><a href="./xref/com/xiantrimble/combinatorics/IndexBasedPermutations.html#196">196</a></td></tr><tr class="a"><td>com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.java</td><td><a href="./xref/com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.html#75">75</a></td></tr><tr class="b"><td colspan='2'><div><pre>      int windowEnd = last.length;
      TYPE: for( int i = 0; i &lt; state.length-1; i++) {
        if( state[i].count == 0 ) continue TYPE;
        long typeCycles = index / (state[i].perms);
        long typeIndex = index % (state[i].perms);
        if( typeIndex == 0 ) {
          index = typeCycles;
          windowStart = typeCycles % 2 == 1 ? windowStart : windowStart + state[i].count;
          windowEnd = typeCycles % 2 == 0 ? windowEnd : windowEnd - state[i].count;
          continue TYPE;
        }
        
        // we are now on the proper state for this index.  On even cycles we are moving down.
        boolean down = typeCycles % 2 == 0;
        typeIndex = down ? typeIndex : (state[i].perms) - typeIndex;
        boolean elementDown = true;
        int aCount = state[i].count;
        int bCount = state[i].activeToRight;
        int aIndex = 0;
        ELEMENT: for( int elementIndex = 0; elementIndex &lt; windowEnd - windowStart; elementIndex++) {
          long perms = elementDown ? mathUtils.p((aCount-1)+bCount, new int[]{ aCount-1, bCount}) : mathUtils.p(aCount+bCount-1, new int[]{ aCount, bCount-1});
          if( typeIndex == perms ) {
            boolean moveMultiple = ((elementIndex % 2) != (aIndex % 2)) ^ !elementDown;
            // this is the element, find the source and target.
            int source = windowStart + elementIndex;
            int target = windowStart + (moveMultiple ? elementIndex + aCount : elementIndex+1 );
            T temp = last[source];</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/xiantrimble/combinatorics/IndexBasedPermutations.java</td><td><a href="./xref/com/xiantrimble/combinatorics/IndexBasedPermutations.html#226">226</a></td></tr><tr class="a"><td>com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.java</td><td><a href="./xref/com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.html#107">107</a></td></tr><tr class="b"><td colspan='2'><div><pre>          }
          else if( typeIndex &lt; perms ^ !elementDown ) {
            typeIndex = elementDown ? typeIndex : typeIndex - perms;
            elementDown = (aIndex % 2) == (elementIndex % 2);
            aCount--;
            aIndex++;
            continue ELEMENT;
          }
          else {
            typeIndex = elementDown ? typeIndex - perms : typeIndex;
            bCount--;
            continue ELEMENT;
          }
        }
      }
      
      pastCombSize = nextIndex;
      // end of permutations for this combination reached.  Advance to the next combination.
      int cur = state.length - 1;
      int remaining = 0;
      
      // move cur backwards to find the next item to update.
      for( ; cur &gt; 0 &amp;&amp; (state[cur].count == 0 || state[cur].toRight &lt; remaining+1); remaining += state[cur--].count ); // back cur up to a position to increment.
      
      // decrement the items at cur.
      state[cur].count--;
      remaining++;
      
      // move forward and update all of the counts.
      for(cur++; cur &lt; state.length; cur++) {
        state[cur].count = Math.min(remaining, domainMultiplicity[cur]);
        remaining -= state[cur].count;
      }
      
      for( int ri = 0, ni2 = 0;ri &lt; domainMultiplicity.length; ri++) {</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/xiantrimble/combinatorics/CombMathUtilsImpl.java</td><td><a href="./xref/com/xiantrimble/combinatorics/CombMathUtilsImpl.html#50">50</a></td></tr><tr class="a"><td>com/xiantrimble/combinatorics/CombMathUtilsImpl.java</td><td><a href="./xref/com/xiantrimble/combinatorics/CombMathUtilsImpl.html#226">226</a></td></tr><tr class="b"><td colspan='2'><div><pre>    stack.addFirst(pccFactory.object().init(k, dm, dm.m, 0, 1, 1));
    
    while( !stack.isEmpty() ) {
      // get the next combination to expand.
      PartialCombinationCount pc = stack.removeFirst();
      
      //System.out.println(pc);
      
      // Start the expansion of this partial combination.
      // pc.k = the number of elements that still need to be added to the combination.
      // pc.dm = the next distinct m to consider.
      // pc.dmk = the size of the next combination of elements to add.
      // pc.ldm = the number of distinct unused elements to the left of mdi minus the number of distinct used elements at mdi.
      // pc.size = the number of combinations already in the solution (in k - pc.k)
      // pc.pd = the permutation count denominator.
      
      // get the current distinct m
      DistinctM cdm = pc.dm;
      //System.out.println(cdm);
      
      // if there could never be an answer, then bail out.
      if( pc.k &gt; (cdm.count + pc.ldm) * pc.dmk + cdm.rn ) {
        //System.out.println(&quot;OPTIMIZED DUE TO LACK OF ELEMENTS.&quot;);
        pccFactory.recycle(pc);
        continue;
      }
      
      // for each number of pc.dmk sized sets that we can create, add new partial combinations.
      for( int e = 0; e &lt;= pc.dm.count + pc.ldm &amp;&amp; e * pc.dmk &lt;= pc.k; e++ ) {
        int nextK = pc.k - (e*pc.dmk);
        int nextDmk = pc.dmk-1;
        long nextSize = pc.size * MathUtils.binomialCoefficient(pc.dm.count + pc.ldm, e);</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/xiantrimble/combinatorics/IndexBasedPermutations.java</td><td><a href="./xref/com/xiantrimble/combinatorics/IndexBasedPermutations.html#168">168</a></td></tr><tr class="a"><td>com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.java</td><td><a href="./xref/com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.html#61">61</a></td></tr><tr class="b"><td colspan='2'><div><pre>          last[ni++] = domain.get(dri).get(j);
        }
      }
      for( int i = state.length - 2; i &gt;= 0; i-- ) {
        state[i].toRight = domainMultiplicity[i+1] + state[i+1].toRight;
        state[i].activeToRight = state[i+1].activeToRight + state[i+1].count;
        state[i].perms = mathUtils.p(state[i].count+state[i].activeToRight, new int[]{ state[i].count, state[i].activeToRight});
      }</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/xiantrimble/combinatorics/IndexBasedPermutations.java</td><td><a href="./xref/com/xiantrimble/combinatorics/IndexBasedPermutations.html#244">244</a></td></tr><tr class="a"><td>com/xiantrimble/combinatorics/Permutations.java</td><td><a href="./xref/com/xiantrimble/combinatorics/Permutations.html#223">223</a></td></tr><tr class="b"><td colspan='2'><div><pre>        int cur = state.length - 1;
        int remaining = 0;
        
        // move cur backwards to find the next item to update.
        for( ; cur &gt; 0 &amp;&amp; (state[cur].count == 0 || state[cur].toRight &lt; remaining+1); remaining += state[cur--].count ); // back cur up to a position to increment.
        
        // decrement the items at cur.
        state[cur].count--;
        remaining++;
        
        // move forward and update all of the counts.
        for(cur++; cur &lt; state.length; cur++) {
          state[cur].count = Math.min(remaining, domainMultiplicity[cur]);
          remaining -= state[cur].count;
        }
        
        // for now, totally reset next.  Making this an incremental update will help when the rank is much smaller than the number of entries.
        for( int ri = 0, ni = 0;ri &lt; domainMultiplicity.length; ri++) {</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/xiantrimble/combinatorics/Permutations.java</td><td><a href="./xref/com/xiantrimble/combinatorics/Permutations.html#269">269</a></td></tr><tr class="a"><td>com/xiantrimble/combinatorics/PermutationsEngine.java</td><td><a href="./xref/com/xiantrimble/combinatorics/PermutationsEngine.html#229">229</a></td></tr><tr class="b"><td colspan='2'><div><pre>      handler.end();
    }
  }

  private static class TypePermutationState {
    public Direction direction = Direction.DOWN;
    public EntryPermutationState[] entryState;
    public int count = 0; // the number of entries being used.
    public int toRight = 0; // the number of items that can occur to the right.
                            // Would be better with the rank array.
    public String toString() {
      return &quot;{direction:&quot; + direction + &quot;, entries:&quot; + Arrays.toString(entryState) + &quot;}&quot;;
    }
  }

  private static class EntryPermutationState {
    public EntryPermutationState(int index) {
      this.index = index;
    }
    public Direction direction = Direction.DOWN;
    public int index = 0;
    public String toString() {
      return &quot;{direction:&quot; + direction + &quot;, index:&quot; + index + &quot;}&quot;;
    }
  }

  private static enum Direction {
    UP, DOWN
  }
}</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.java</td><td><a href="./xref/com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.html#125">125</a></td></tr><tr class="a"><td>com/xiantrimble/combinatorics/Permutations.java</td><td><a href="./xref/com/xiantrimble/combinatorics/Permutations.html#223">223</a></td></tr><tr class="b"><td colspan='2'><div><pre>        int cur = state.length - 1;
        int remaining = 0;
        
        // move cur backwards to find the next item to update.
        for( ; cur &gt; 0 &amp;&amp; (state[cur].count == 0 || state[cur].toRight &lt; remaining+1); remaining += state[cur--].count ); // back cur up to a position to increment.
        
        // decrement the items at cur.
        state[cur].count--;
        remaining++;
        
        // move forward and update all of the counts.
        for(cur++; cur &lt; state.length; cur++) {
          state[cur].count = Math.min(remaining, domainMultiplicity[cur]);
          remaining -= state[cur].count;
        }
        
        // for now, totally reset next.  Making this an incremental update will help when the rank is much smaller than the number of entries.
        for( int ri = 0, ni = 0;ri &lt; domainMultiplicity.length; ri++) {</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.java</td><td><a href="./xref/com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.html#163">163</a></td></tr><tr class="a"><td>com/xiantrimble/combinatorics/PermutationsEngine.java</td><td><a href="./xref/com/xiantrimble/combinatorics/PermutationsEngine.html#234">234</a></td></tr><tr class="b"><td colspan='2'><div><pre>    public Direction direction = Direction.DOWN;
    public EntryPermutationState[] entryState;
    public int count = 0; // the number of entries being used.
    public int toRight = 0; // the number of items that can occur to the right.  Would be better with the rank array.
    public String toString() {
      return &quot;{direction:&quot;+direction+&quot;, entries:&quot;+Arrays.toString(entryState)+&quot;}&quot;;
    }
  }
  
  private static class EntryPermutationState
  {
    public EntryPermutationState(int index) {
      this.index = index;
    }
    public Direction direction = Direction.DOWN;
    public int index = 0;
    public String toString() {
      return &quot;{direction:&quot;+direction+&quot;, index:&quot;+index+&quot;}&quot;;
    }
  }
  
  private static enum Direction
  {
    UP,DOWN
  }

}</pre></div></td></tr></table><table border="0" class="table table-striped"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>com/xiantrimble/combinatorics/IndexBasedPermutations.java</td><td><a href="./xref/com/xiantrimble/combinatorics/IndexBasedPermutations.html#262">262</a></td></tr><tr class="a"><td>com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.java</td><td><a href="./xref/com/xiantrimble/combinatorics/IndexBasedPermutationsEngine.html#143">143</a></td></tr><tr class="b"><td colspan='2'><div><pre>          last[ni2++] = domain.get(ri).get(j);
        }
      }
      
      for( int i = state.length - 2; i &gt;= 0; i-- ) {
        state[i].activeToRight = state[i+1].activeToRight + state[i+1].count;
        state[i].perms = mathUtils.p(state[i].count+state[i].activeToRight, new int[]{ state[i].count, state[i].activeToRight});
      }</pre></div></td></tr></table></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2013.
          All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
